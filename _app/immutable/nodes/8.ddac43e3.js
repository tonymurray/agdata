import{s as ya,n as Z,o as ba}from"../chunks/scheduler.e108d1fd.js";import{S as wa,i as Ca,g as pa,s as ka,h as ua,c as Ra,x as Ea,k as E,a as K,f as Q}from"../chunks/index.5ae4157e.js";import{j as Sa}from"../chunks/jquery.5af47638.js";import{l as L}from"../chunks/loadscript.5be5f31a.js";function xa(J){let y,S,p,x='<h1 class="drupal initial1 svelte-1665e3l" data-key="title"></h1> <div class="drupal initial1" data-role="landing" data-key="subtitle"></div> <select id="country-selector" class="ap-country-selector" data-role="landing"></select> <div class="ap-filters" data-role="details"><label class="drupal" data-key="filter-by"></label> <label for="agencytype" class="drupal" data-key="agency-type"></label> <select id="agencytype" class="ap-dropdown"></select> <label for="country" class="drupal" data-key="country"></label> <select id="iso3" class="ap-dropdown"></select> <label for="researchfocus" class="drupal" data-key="research-focus"></label> <select id="researchfocus" class="ap-dropdown"></select> <button id="clear-filters" class="drupal clear-filters" data-key="clear-filters"></button></div> <div class="ap-map-container"><div id="ap-map" class="ap-map svelte-1665e3l"></div> <div id="tooltip" class="map-hidden-tooltip map-tooltip"><div class="map-tooltip-anchor"></div><div class="map-tooltip-tip"></div> <div data-role="acronym"></div> <div data-role="name"></div> <div data-role="parent"></div></div> <div id="spinner" class="ap-spinner"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div></div></div> <button class="ap-view-button drupal" data-key="list-view" data-role="details"></button> <button class="active ap-view-button drupal" data-key="tile-view" data-role="details"></button> <div id="ap-count" class="ap-agencies-count drupal" data-key="loading" data-role="details"></div> <div class="ap-sort" data-role="details"><label class="drupal" data-key="sort-by"></label> <button class="drupal" data-sort-key="name" data-key="agency-name"></button></div> <div class="tile-view ap-content" data-role="details"><div id="ap-container" class="ap-boxes"><div class="ap-column"></div> <div class="ap-column"></div> <div class="ap-column"></div> <div class="ap-box"><div class="ap-btn-toggle-wrap"><div class="ap-btn-plus ap-btn-toggle"></div> <div class="ap-btn-minus ap-btn-toggle"></div></div> <div class="ap-box-header ap-border-bottom"><span data-property="country"></span> <span data-property="acronym" class="ap-box-agency-country"></span> <div class="ap-box-names"><h3 data-property="name" data-class="agencytype" class="ap-box-agency-name"></h3> <h4 data-property="parent_organization" class="ap-box-supervising-name"></h4></div></div> <div class="ap-box-content"><div class="ap-box-address ap-border-bottom"><div><span data-optional="" data-property="state"></span></div> <div><span class="drupal" data-key="first-year"></span><span data-property="firstresearchyear"></span></div></div> <div class="ap-box-data ap-border-bottom"><div data-indicator="RES.FTE,RES.PHD.SHRE,RES.FEMALE.SHRE,RES.OVER50.SHRE" class="ap-data-row"><div class="ap-data-label"><strong data-indicator-property="value"></strong> <span data-indicator-property="label"></span> <span data-indicator-property="year"></span></div> <div class="ap-data-bar"><div data-indicator-property="bar"></div></div></div></div> <div class="ap-commodity-header"><span class="drupal" data-key="commodity-focus"></span> <span data-indicator-property="focus-year"></span></div> <div class="ap-commodity-data"><div data-indicator="RES.COM.TOTCRP.SHRE,RES.COM.FISH.SHRE,RES.COM.FORESTRY.SHRE,RES.COM.LIVEST.SHRE,RES.COM.NATRES.SHRE,RES.COM.SOCIOECON.SHRE,RES.COM.MISC.SHRE" class="ap-commodity"><span title="" data-indicator-property="value"></span></div></div> <div class="ap-buttons"><button class="drupal" data-key="view-agency"></button></div></div></div></div> <div class="ap-buttons"><button id="show-more" class="drupal" data-key="show-more"></button></div></div>';return{c(){y=pa("link"),S=ka(),p=pa("div"),p.innerHTML=x,this.h()},l(v){y=ua(v,"LINK",{rel:!0,type:!0,href:!0}),S=Ra(v),p=ua(v,"DIV",{id:!0,class:!0,"data-role":!0,"data-country":!0,"data-tile-limit":!0,"data-svelte-h":!0}),Ea(p)!=="svelte-18piqm7"&&(p.innerHTML=x),this.h()},h(){E(y,"rel","stylesheet"),E(y,"type","text/css"),E(y,"href","/agencies/agencypool.css"),E(p,"id","ap-root"),E(p,"class","ap-wrapper svelte-1665e3l"),E(p,"data-role","landing"),E(p,"data-country",""),E(p,"data-tile-limit","")},m(v,a){K(v,y,a),K(v,S,a),K(v,p,a)},p:Z,i:Z,o:Z,d(v){v&&(Q(y),Q(S),Q(p))}}}function La(J){return ba(async()=>{await L("/common/jquery-3.6.0.min.js"),await L("https://maps.googleapis.com/maps/api/js?key=TBD&callback=Function.prototype"),await Promise.all([L("/agencies/jquery-ui.min.js"),L("/agencies/jquery.xdomainrequest.min.js"),L("/agencies/markerclusterer.js"),L("/agencies/oms.min.js"),L("/common/mw.js")]);const S=new URL(window.location.href).searchParams;let p=S.get("lang"),x=S.get("country");if(x=x&&x!==""?x.slice(0,3):"",p=p&&p!==""?p.slice(0,2):"en",v===void 0)var v=window;if(v.asti={config:{enablemap:!0,iso3:"",lang:"en",root:"https://localhost/",site:"https://localhost/",file:"/var/www/asti.cgiar.org/htdocs/sites/all/libraries/mw/",json:"https://dataportal.asti.cgiar.org/json",astilegacy:"https://www.asti.cgiar.org/",tool:"agencies",path:"/",api:{public:{token:"public",url:"https://dataportal.asti.cgiar.org/api/public",language:"en",version:2}}}},!asti.config.enablemap){const a=document.querySelector(".ap-map");a&&a.classList.add("mapdisabled")}Sa(document).ready(function(a){var T=asti.config.lang;T!="en"&&(mw.support.THOUSSEP=".",mw.support.DECSEP=",");var I=asti.config.astilegacy+"/directory/{COUNTRY}/{PARENTABBR}/{ABBR}";T=="fr"&&(I=asti.config.astilegacy+"fr/directory/{COUNTRY}/{PARENTABBR}/{ABBR}"),T=="es"&&(I=asti.config.astilegacy+"es/directory/{COUNTRY}/{PARENTABBR}/{ABBR}");var X=20,$=50,m,N,F=new google.maps.OverlayView;F.draw=function(){};var w=[],g={},U=[],aa,D={},z=X,C,_=[],ta=!0,ea=5,k={agencytype:{},iso3:{},researchfocus:{}},A={},q="name",V={},Y,fa={path:"M0,0m-8,0a8,8 0 1,0 16,0a8,8 0 1,0 -16,0",fillColor:"#ff7f00",fillOpacity:1,anchor:new google.maps.Point(0,0),strokeColor:"#fff",strokeWeight:1,scale:1},c=new mw.DataManager({data:{geoitems:{},indicators:{}}});function va(s,r){var o=g[s];return r.replace("{AID}",s).replace("{LANG}",T).replace("{COUNTRY}",o.country.toLowerCase()).replace("{PARENTABBR}",o.parent_acronym).replace("{PARENT}",o.parent_organization).replace("{ABBR}",o.official_acronym).replace("{NAME}",o.official_name)}function ga(s){var r=s.indexOf("?")==-1?"?":"&";return a.ajax({url:asti.config.json+s+r+"lang="+T,data:{}})}function W(s,r,o){var i=r&&r.api?r.api:"public",e=mw.support.extend(asti.config.api[i],{}),t=e.url;return delete e.url,r&&delete r.api,a.ajax({url:t+s,type:o||"GET",data:mw.support.extend(r||{},e),contentType:"application/json",dataType:"json"})}function ia(){j(!0)}function j(s){if(C=0,asti.config.enablemap){for(var r=m.getBounds(),o=new google.maps.LatLngBounds,i=0,e=w.length;i<e;i++){var t=w[i].id,n=g[t],l=n instanceof Object;if(l)for(var d in A){var u=A[d];if(u!=""&&u!=null&&n[d]!==u&&!n[d][u]){l=!1;break}}s&&l&&!r.contains(w[i].position)&&(l=!1),n&&g[t]&&typeof g[t]=="object"&&(g[t].visible=l),s||(w[i].setVisible(l),l&&o.extend(w[i].position)),l&&C++}C&&!s&&(N.remove(),google.maps.event.addListenerOnce(m,"idle",function(){N=m.addListener("idle",ia)}),m.fitBounds(o))}Y&&Y.repaint(),a("#ap-count").html(mw.support.format(c.meta["agencies-found"],C)),setTimeout(function(){a("#ap-map").css("opacity",1)},0),G()}function G(){var s=a("[data-sort-key].selected"),r=s.attr("data-sort-key"),o=s.hasClass("down"),i=c.indicators[r];U.sort(function(B,R){var da=g[B],ca=g[R],P,H;return i?(P=+i.current[da.agencyid],H=+i.current[ca.agencyid]):(P=da[r].toLowerCase(),H=ca[r].toLowerCase()),o?P<H?1:-1:P<H?-1:1});for(var e=C<$?C:Math.min(z,C),t=document.getElementById("ap-container"),n=t.offsetWidth>900?3:t.offsetWidth>600?2:1,l=["","",""],d=0,u=0,f=w.length,M=e;d<f;d++){var h=U[d],b=g[h];if(!(!b||b.visible===!1)){var O=D[h];if(O.find("[data-indicator]").removeClass("selected"),r!="name"?O.find('[data-indicator="'+r+'"]').addClass("selected"):O.find("[data-indicator]:first").addClass("selected"),l[u++]+=O.prop("outerHTML"),u==n&&(u=0),--M==0)break}}q=r;for(var d=0;d<3;d++)t.children[d].innerHTML=l[d];a("#show-more").toggle(e<C)}function ha(s){var r=aa.clone();return r.attr("id","a-"+s.agencyid).addClass("is-closed"),r.find("[data-class]").each(function(){var o=this.getAttribute("data-class"),i=s[o];i&&this.classList.add(i.toLowerCase().replace(/[^\w]/g,""))}),r.find("[data-property]").each(function(){var o=this.getAttribute("data-property"),i=s[o];if((!i||i=="0000")&&!this.hasAttribute("data-optional"))i='<span class="no-data">'+c.meta["no-data"]+"</span>";else if(o=="website"){var e=i;e.match(/^https?:../)||(e="http://"+e),e=e.replace("window.location.host",""),i='<a href="'+e+'" target="_blank">'+i.replace(/^https?:../,"")+"</a>"}this.innerHTML=i}),r.find("[data-indicator]").each(function(){var o,i,e=this.getAttribute("data-indicator").split(",");e.length>1&&(i=a(this).parent(),o=a(this).detach());for(var t=0;t<e.length;t++){var n=e[t],l=o?o.clone():a(this);l.hide(),o&&(l.attr("data-indicator",n),i.append(l),l.hasClass("ap-commodity")&&l.attr("title",c.meta["focus-indicators"][n]))}}),r}function sa(s){var r=new google.maps.LatLng(+s.latitude,+s.longitude),o=new google.maps.Marker({position:r,draggable:!1,id:s.agencyid,icon:fa});o.addListener("mouseover",function(){var i=g[this.id];c.indicators["RES.FTE"];var e=a("#tooltip");e.find('[data-role="name"]').html(i.name||i),e.find('[data-role="acronym"]').html(i.acronym||""),e.find('[data-role="parent"]').html(i.parent_organization||"");var t=F.getProjection(),n=t.fromLatLngToContainerPixel(this.getPosition());e.css({left:n.x,top:n.y-e.height()-15}).removeClass("map-hidden-tooltip")}),o.addListener("mouseout",function(){a("#tooltip").addClass("map-hidden-tooltip")}),w.push(o)}function ra(){Y=new MarkerClusterer(m,w,{gridSize:50,maxZoom:15,styles:[{url:asti.config.path+asti.config.tool+"/css/circle24.png",height:24,width:24,anchor:[0,0],textColor:"#fff",textSize:10},{url:asti.config.path+asti.config.tool+"/css/circle30.png",height:30,width:30,anchor:[0,0],textColor:"#fff",textSize:12}]})}function oa(){for(var s in k){var r=[];for(var o in k[s])r.push({label:k[s][o],value:o});r.sort(function(l,d){return l.label<d.label?-1:1});for(var i=a("#"+s),e="",t=0;t<r.length;t++)e+='<option value="'+r[t].value+'"',r[t].value==A[s]&&(e+=" selected"),e+=">"+r[t].label+"</option>";var n=c.meta["select."+s]?c.meta["select."+s]:c.meta.select;if(i.html('<option value="">'+n+"</option>"+e).off("change").on("change",function(l){A[this.id]=this.value;var d=document.getElementById("PageTitle");if(d){var u=d.innerHTML.indexOf(": ");u!=-1&&(d.innerHTML=d.innerHTML.substr(0,u+2)+c.geoitems[this.value].label)}this.id=="iso3"&&!V[this.value]?la(this.value):j(!1)}),s=="iso3"){var i=a("#country-selector");i.html('<option value="">'+c.meta["select-country"]+"</option>"+e).off("change").on("change",function(d){this.value!=""&&na(this.value)})}}}function ma(s){a("#spinner").show(),a.when(W("/agencies/geo")).done(function(r){a("#spinner").hide();for(var o=0,i=r.data.length;o<i;o++){var e=r.data[o];e.latitude==0||e.longitude==0||e.latitude==null||e.longitude==null||(asti.config.enablemap&&sa(e),g[e.agencyid]=e.official_name)}asti.config.enablemap?(console.log("creating a cluster"),ra()):console.log("Map is disabled"),s&&s()})}function na(s){A.iso3!=s&&(a("#ap-root").attr("data-role","details"),google.maps.event.trigger(m,"resize"),A.iso3=s,V[s]?j(!1):la(s))}function la(s){a("#spinner").show(),a("#ap-count").html(c.meta.loading),a(".ap-column").empty();var r={keyvalues:1};s&&(r.countries=[s]),a.when(W("/agencies/list",r)).done(function(o){a("#spinner").hide();for(var i=0,e=o.data.length;i<e;i++){var t=o.data[i];if(!(t.latitude==0||t.longitude==0||t.latitude==null||t.longitude==null)){var n=t.agencyid,l=D[n];t.name=t.official_name==""?"(unknown)":t.official_name,t.acronym=(t.parent_acronym!=null&&t.parent_acronym!=""?t.parent_acronym+"-":"")+t.official_acronym,t.researchfocus={};for(var d in k)d=="agencytype"&&(k[d][t[d]]=t[d]);g.hasOwnProperty(n)||sa(t),l||(U.push(n),D[n]=l=ha(t)),l.find("[data-indicator]").each(function(){var f=this.getAttribute("data-indicator"),M=c.meta["focus-indicators"][f],h=t.keyvalues[f],b=-1/0;c.indicators[f]||(c.indicators[f]={current:{}});var O=c.meta["key-indicators"][f]||c.meta["sort-indicators"][f],B;if(h){for(var R in h)M&&(h[R]*=100),h[R]=parseFloat(h[R]),R>b&&(b=R,c.indicators[f].current[n]=h[R]);M&&h[b]<ea?this.parentNode.removeChild(this):(B=mw.support.format(f.match(".SHRE$")?"%0.1f%%":"%0.1f",h[b]),a(this).find('[data-indicator-property="bar"]').css("width",h[b]+"%"),a(this).find('[data-indicator-property="year"]').html(b),M&&(t.researchfocus[f]=!0,a(this).closest(".ap-box-content").find('[data-indicator-property="focus-year"]').html(b)))}else c.indicators[f].current[n]="",M?this.parentNode.removeChild(this):(B='<span class="no-data">'+c.meta["no-data"]+"</span>",a(this).find('[data-indicator-property="year"]').hide());a(this).find('[data-indicator-property="label"]').html(O),a(this).find('[data-indicator-property="value"]').html(B),a(this).toggleClass("selected",q==f||q=="name"&&f=="RES.FTE").attr("style","")});var u=l.find(".ap-commodity-data");u.children().length==0&&u.append('<span class="no-data">'+c.meta["no-data"]+"</span>"),g[n]=t,a("#a-"+n).html(l.html())}}if(ta){ta=!1;for(var d in c.meta["sort-indicators"])a(".ap-sort").append('<button data-sort-key="'+d+'">'+c.meta["sort-indicators"][d]+"</button>")}asti.config.enablemap&&ra(),oa(),j(!1)}),V[s]=!0}a.when(W("/countries/list"),a.ajax(asti.config.json+"/newcountries?lang="+T)).done(function(s,r){for(var n=s[0],o=0,i=n.data.length;o<i;o++){var e=n.data[o],t=e.iso3||e.ISO3;e.label=e.name,c.geoitems[t]=e}var n=r[0];n instanceof Array&&(n=n[0]);for(var l in n){var e=c.geoitems[l];e&&(e.profile=n[l],e.profile&&(k.iso3[l]=e.label))}var d=a("#ap-root").attr("data-country");d&&a("#ap-root").find("h1").append(" - "+c.geoitems[d].label),oa()}),a.when(ga("/directory-agency"),a.ajax({url:"/agencies/mapstyles.json",contentType:"application/json"})).done(function(s,r){a("#ap-root").attr("data-tile-limit")&&($=+a("#ap-root").attr("data-tile-limit"));var o=c.meta=s[0];a(".drupal").each(function(){var t=o[this.getAttribute("data-key")];this.hasAttribute("data-attribute")?a(this).attr(this.getAttribute("data-attribute"),t||"{"+this.getAttribute("data-key")+"}"):a(this).html(t||"{"+this.getAttribute("data-key")+"}")}),o.hasOwnProperty("focus-threshold")&&(ea=+o["focus-threshold"]),asti.config.enablemap&&(m=new google.maps.Map(document.getElementById("ap-map"),{center:{lat:0,lng:0},disableDefaultUI:!0,zoomControl:!0,minZoom:2,maxZoom:13,zoom:2}),F.setMap(m),m.mapTypes.set("custom",new google.maps.StyledMapType(r[0],{name:"Custom"})),m.setMapTypeId("custom"),N=m.addListener("idle",ia)),aa=a(".ap-box").detach(),a("body").on("click",".ap-box",function(t){a(this).toggleClass("is-closed"),a(this).toggleClass("is-open"),t.preventDefault()}),a("#show-more").on("click",function(){z=Math.min(z+X,w.length),G()}),a("body").on("click",".ap-box button",function(t){var n=a(t.target).closest(".ap-box");const l=va(n.attr("id").substr(2),I);window.open(l,"_blank")}),a("#clear-filters").on("click",function(){for(var t in k)a("#"+t).val("");j(!1)}),a("body").on("click","[data-sort-key]",function(t){var n=a(t.target);n.hasClass("up")?n.removeClass("up").addClass("down"):n.hasClass("down")?n.removeClass("down").addClass("up"):(a("[data-sort-key]").removeClass("down up selected"),n.addClass("selected").addClass(n.attr("data-sort-key")=="name"?"up":"down")),G()}),a("[data-sort-key]:first").addClass("selected up"),a(".ap-view-button").on("click",function(){a(".ap-view-button").removeClass("active"),a(this).addClass("active"),a(".ap-content").removeClass("tile-view list-view").addClass(this.getAttribute("data-key"))});for(var i in c.meta["key-indicators"])_.push(i);for(i in c.meta["sort-indicators"])_.indexOf(i)==-1&&_.push(i);for(var i in c.meta["focus-indicators"])_.indexOf(i)==-1&&_.push(i),k.researchfocus[i]=c.meta["focus-indicators"][i];var e=a("#ap-root").attr("data-country");e?(a("#ap-map").css("opacity",0),na(e)):ma()})})}),[]}class _a extends wa{constructor(y){super(),Ca(this,y,La,xa,ya,{})}}export{_a as component};
